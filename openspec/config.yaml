schema: spec-driven

context: |
  # Habit Coach AI — Plataforma de Coaching de Hábitos com IA

  ## Domain
  Plataforma SaaS de coaching personalizado para construção de hábitos e alcance de metas,
  diferenciada pela integração de IA com personalidades de personagens famosos icônicos
  (Mestre Yoda, General Motivador, etc.).
  Cada usuário visualiza apenas seus próprios dados (user_id scoping em todas as queries).
  Modelo de negócio freemium com plano Pro (R$ 29,90/mês).

  ### Core Features (MVP):
  - Sistema de hábitos (rastreamento, streaks, checklist diária)
  - Sistema de metas (com decomposição automática de subtarefas via MCP/IA)
  - IA conversacional com personalidades famosas
  - Dashboards de visualização de progresso
  - Notificações no app

  ## Reference
  **Tech Stack, Project Structure, Patterns, and Conventions are documented in `docs/PATTERNS.md`.**
  Always consult this file for:
  - Route groups and feature module structure
  - Page, Server Actions, and Form patterns
  - Database (Drizzle ORM) conventions
  - Auth utilities and flows
  - UI/Component best practices

rules:
  proposal:
    - Sempre considerar o feature module pattern existente (pages → actions → components → schemas → types)
    - Propostas devem especificar a qual route group a feature pertence — (private), (public) ou compartilhado
    - Incluir mudanças de schema do banco quando a feature requer novas tabelas ou colunas
    - Considerar isolamento de dados por usuário (userId filtering) para todas as operações
    - Todos os textos voltados ao usuário devem seguir as diretrizes de i18n com foco em pt-BR
    - Considerar os limites do plano Free vs Pro (ex: 3 hábitos, 1 meta, 1 personalidade de IA)
    - Mencionar se a feature envolve integração com IA (OpenAI/MCP)

  tasks:
    - Quebrar tarefas em chunks de no máximo 2 horas
    - Cada tarefa deve especificar arquivos afetados e o pattern que seguem
    - Server actions devem usar next-safe-action com validação Zod
    - Incluir criação de Zod schema como tarefa separada quando novos formulários estão envolvidos
    - Tarefas de migração de banco de dados devem ser separadas das tarefas de código da aplicação
    - Sempre incluir chamadas de revalidatePath após actions de mutação
    - Incluir tipagem TypeScript (types/) como tarefa quando novos tipos são necessários
    - Considerar criação de testes como tarefa separada quando aplicável
